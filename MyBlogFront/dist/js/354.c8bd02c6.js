"use strict";(self["webpackChunkmyblogfront"]=self["webpackChunkmyblogfront"]||[]).push([[354],{2542:function(t,e,s){s.d(e,{Z:function(){return l}});var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"comment"},[s("div",{staticClass:"comment-header"},[s("div",{on:{click:t.handleClick}},[s("input",{attrs:{type:"file",id:"avatarInput"},on:{change:t.uploadAvatar}}),s("el-avatar",{attrs:{src:t.avatarUrl?t.avatarUrl:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png",size:40}})],1),s("el-input",{staticClass:"input-with-select",attrs:{placeholder:t.placeholderText,type:"textarea",resize:"none",size:"mini",maxlength:t.contentLength},on:{focus:function(e){return t.isShowSecReply(void 0)}},model:{value:t.context,callback:function(e){t.context=e},expression:"context"}}),s("el-button",{staticStyle:{height:"40px"},attrs:{type:"info"},on:{click:function(e){return t.submitInfo(t.keyId,void 0)}}},[t._v(t._s(t.buttonText))])],1),t._l(t.comments,(function(e,i){return s("div",{key:e.murmur+""+i,staticClass:"comment-body"},[s("div",{staticClass:"first-comment"},[s("el-avatar",{attrs:{size:40}}),s("div",{staticClass:"content"},[s("h3",[t._v(t._s(e.username))]),s("span",[t._v(t._s(e.date))]),s("p",{staticStyle:{"padding-right":"30px"}},[t._v(" "+t._s(e.content)+" ")]),s("div",{staticClass:"comment-right"},[s("i",{staticClass:"iconfont icon-icon",class:e.favour.includes(t.murmur)?"active":"",on:{click:function(s){return t.giveALike(e,e._id)}}}),t._v(t._s(e.favour.length||0)+" "),s("i",{staticClass:"el-icon-chat-dot-round",on:{click:function(s){return t.isShowSecReply(e._id)}}},[t._v(" 回复")]),t.murmur===e.murmur?s("i",{staticClass:"el-icon-delete",on:{click:function(s){return t.deleteComment(e._id,void 0)}}},[t._v(" 删除")]):t._e()]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowSec===e._id,expression:"isShowSec === item._id"}],staticClass:"reply-comment"},[s("el-input",{attrs:{placeholder:"请输入最多150字的评论....",maxlength:150},model:{value:t.replyContext,callback:function(e){t.replyContext=e},expression:"replyContext"}}),s("el-button",{staticClass:"reply-button",attrs:{type:"info",size:"mini"},on:{click:function(s){return t.submitInfo(e._id,e.username)}}},[t._v("回复 ")])],1),t._l(e.replyInfo,(function(i,a){return s("div",{key:i.murmur+""+a,staticClass:"second-comment"},[s("el-avatar",{attrs:{size:40,src:i.avatar}}),s("div",{staticClass:"content"},[s("h3",[t._v(t._s(i.username))]),s("span",[t._v(t._s(i.date))]),s("p",{staticStyle:{"padding-right":"30px"}},[s("span",{staticClass:"to_reply"},[t._v(t._s(i.username))]),t._v(" 回复 "),s("span",{staticClass:"to_reply"},[t._v(t._s(i.replyName))]),t._v("： "+t._s(i.reply)+" ")]),s("div",{staticClass:"comment-right"},[s("i",{staticClass:"iconfont icon-icon",class:i.favour.includes(t.murmur)?"active":"",on:{click:function(s){return t.giveALike(i,e._id)}}}),t._v(t._s(i.favour?i.favour.length:0)+" "),s("i",{staticClass:"el-icon-chat-dot-round",on:{click:function(e){return t.isShowSecReply(i._id)}}},[t._v("回复")]),t.murmur===i.murmur?s("i",{staticClass:"el-icon-delete",on:{click:function(s){return t.deleteComment(e._id,i._id)}}},[t._v("删除")]):t._e()]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowSec===i._id,expression:"isShowSec === reply._id"}],staticClass:"reply-comment"},[s("el-input",{attrs:{placeholder:"请输入最多150字的评论....",maxlength:150},model:{value:t.replyContext,callback:function(e){t.replyContext=e},expression:"replyContext"}}),s("el-button",{staticClass:"reply-button",attrs:{type:"info",size:"mini"},on:{click:function(s){return t.submitInfo(e._id,i.username)}}},[t._v("回复 ")])],1)])],1)}))],2)],1)])})),s("div",{staticClass:"pagenation"},[s("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:10,"hide-on-single-page":!0,"page-size":t.pageSize}})],1),s("el-empty",{directives:[{name:"show",rawName:"v-show",value:0===t.comments.length,expression:"comments.length === 0"}],attrs:{description:t.emptyText}})],2)},a=[],n=(s(1703),s(2536)),r={props:{keyId:{type:String},emptyText:{type:String},buttonText:{type:String},contentLength:{type:Number},placeholderText:{type:String}},data(){return{comments:[],context:"",replyContext:"",isFirCom:"",isShowSec:"",pageSize:11,isClickId:"",replyName:"",murmur:localStorage.getItem("browserId"),page:1,pageStart:0,username:"",avatarUrl:""}},mounted(){this.getCommentList()},methods:{handleCurrentChange(t){this.pageStart=this.pageSize*(t-1),this.getCommentList(this.pageStart,this.pageSize)},handleClick(){const t=document.querySelector("#avatarInput");t.click()},uploadAvatar(t){const e=2097152;this.loading=!0;const s=Array.prototype.slice.call(t.target.files)[0],i=new FileReader;i.readAsDataURL(s),i.onload=async t=>{let i=null;if(s.size>e){let a=new Image;a.src=t.target.result,a.onload=async()=>{const t=(0,n.CP)(a);if(t.length>e)this.$message.error("上传图片过大");else{i=(0,n.dj)(t,"image/jpeg",s.name);const e=new FormData;e.append("file",i),e.append("murmur",this.murmur);const a=await this.$api.uploadImg(e);this.avatarUrl=a.avatarUrl}}}else{i=(0,n.dj)(t.target.result,s.type,s.name);const e=new FormData;e.append("file",i),e.append("murmur",this.murmur);const a=await this.$api.uploadImg(e);this.avatarUrl=a.avatarUrl}}},submitInfo(t,e){this.username?this.addComment(t,e):this.$prompt("请输入你的名字",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((s=>{if(!s.value)throw new Error;this.$api.addMurmur({murmur:this.murmur,username:s.value}).then((s=>{this.addComment(t,e),this.username=s.data.username}))})).catch((t=>{"cancel"==t?this.$message({type:"info",message:"取消输入"}):this.$message.warning({message:"名字不能为空哦！"})}))},async getCommentList(t,e){try{this.comments=[];let s="";s="messageBoard"==this.keyId?"messageBoard":this.keyId;const i=await this.$api.getComments({id:s,pageSize:e,pageStart:t,murmur:this.murmur});this.comments=i.data?.comments,console.log(i),this.username=i.data.user?.username,this.avatarUrl=i.data.user?.avatarUrl}catch(s){this.$message.error(s)}},giveALike(t,e){try{let s=null;if(t.favour?.includes(this.murmur))return void this.$message.info("您已经点过赞啦！");t.replyName?this.$api.addsecondfavour({replyId:t._id,_id:e,favourMurmur:this.murmur}).then((e=>{this.$message.success(e.msg),t.favour.push(this.murmur)})).catch((()=>{this.$message.error(s.msg)})):this.$api.addfirstfavour({_id:e,favourMurmur:this.murmur}).then((e=>{this.$message.success(e.msg),t.favour.push(this.murmur)})).catch((()=>{this.$message.error(s.msg)}))}catch(s){this.$message.error(s)}},isShowSecReply(t){t?(this.isShowSec=t,this.isClickId===this.isShowSec?this.isShowSec="":this.isShowSec=t,this.isClickId=this.isShowSec):this.isShowSec=this.isClickId=""},deleteComment(t,e){let s=null;s=e?this.$api.deletesecondcomment({replyId:e,_id:t}).then((s=>{this.$message.success(s.msg);const i=this.comments.find((e=>e._id==t)).replyInfo;for(let t=0;t<i.length;t++)if(i[t]._id==e){i.splice(t,1);break}})).catch((()=>{this.$message.error(s.msg)})):this.$api.deletefirstcomment({_id:t}).then((e=>{this.$message.success(e.msg);for(let s=0;s<this.comments.length;s++)this.comments[s]._id==t&&this.comments.splice(s,1)})).catch((()=>{this.$message.error(s.msg)}))},async addComment(t,e){let s=null;if(e){if(!this.replyContext)return void this.$message.warning("评论或留言不能为空哦！");s=await this.$api.addsecondcomment({_id:t,reply:this.replyContext,replyName:e,murmur:this.murmur}),s.data.username=this.username,this.comments.find((e=>e._id==t)).replyInfo.push(s.data),this.replyContext=""}else{if(!this.context)return void this.$message.warning("评论或留言不能为空哦！");s=await this.$api.addfirstcomment({keyId:t,content:this.context,murmur:this.murmur}),s.data.username=this.username,this.comments.push(s.data),this.context=""}200===s.status?this.$message.success(s.msg):this.$message.error(s,msg),this.isShowSec=this.isClickId=""}}},o=r,c=s(1001),m=(0,c.Z)(o,i,a,!1,null,"4d2ba4f6",null),l=m.exports},1354:function(t,e,s){s.r(e),s.d(e,{default:function(){return l}});var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"message-box"},[s("transition",{attrs:{name:"el-zoom-in-center"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.showTip,expression:"showTip"}],staticClass:"tip-box"},[s("h2",[t._v("留言板")]),s("p",[t._v("欢迎访问我的博客，我是面谱人生，一名零零后程序猿。")]),s("br"),s("p",[t._v(" 当我站在二十岁的分岔口去回忆我的前二十年人生，却是一片模糊，似乎有过意难平，似乎弄丢了一些人，似乎...有很多很多有意思的事，可再也记不起来了，就好像这些经历属于带面具的我，不属于我， 留给我的只是一堆遗憾罢了。 ")]),s("br"),s("p",[t._v("现在，在这稍纵即逝的青春的尾巴上，我被生活裹挟着向前疾驰，希望能够留下些沿途的风景，于是有了在这个博客。")]),s("br"),s("p",[t._v("这些是我想说的话，你想对我说些什么呢？")])])]),s("transition",{attrs:{name:"el-zoom-in-top"}},[s("Comment",{directives:[{name:"show",rawName:"v-show",value:t.showMian,expression:"showMian"}],attrs:{keyId:"messageBoard",emptyText:"期待您的留言！",buttonText:"留言",contentLength:200,placeholderText:"请输入最多200字的留言..."}})],1)],1)},a=[],n=s(2542),r={components:{Comment:n.Z},data(){return{showTip:!1,showMian:!1}},mounted(){setTimeout((()=>{this.showTip=!0,this.showMian=!0}),150)}},o=r,c=s(1001),m=(0,c.Z)(o,i,a,!1,null,null,null),l=m.exports}}]);
//# sourceMappingURL=354.c8bd02c6.js.map